var mongoose = require("mongoose");

var showroomSchema = mongoose.Schema({
	name : {
		type : String,
		required: true
	},
	address : {
		type : String,
		required: true
	},
	telno : {
		type : String,
		required: true
	},
	cars : {
		type : Array
	},
	create_date : {
		type : Date,
		default: Date.now
	}
});

var Showroom = module.exports = mongoose.model("Showroom",showroomSchema);

// GET cars

module.exports.getShowrooms  = function(callback,limit){
	Showroom.find(callback).limit(limit);
};

module.exports.getShowroomById  = function(id,callback){
	Showroom.findById(id,callback);
};

// ADD Showroom
module.exports.addShowroom = function(showroom,callback){
	Showroom.create(showroom,callback);
};

// UPDATE Showroom
module.exports.updateShowroom = function(id,showroom,options,callback){
	var query = {_id : id};
	var update = {
		name : showroom.name,
		address : showroom.address,
		telno : showroom.telno
	}
	Showroom.findOneAndUpdate(query,update,options,callback);
};

module.exports.addCarToShowroom = function(id,car,callback){
	var query = {_id : id};
	console.log("ID: " + id);
	Showroom.findOne(query,"cars",function(err,showroom){
		if (err){
			console.log("There is an error");
			return handleError(err);
		}
		showroom.cars.push(car);
	});
};

module.exports.removeShowroom = function(id,showroom,options,callback){
	var query = {_id : id};
	Showroom.remove(query,callback);
};